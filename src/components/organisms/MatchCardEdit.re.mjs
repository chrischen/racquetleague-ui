// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Zod from "zod";
import * as Form from "../molecules/forms/Form.re.mjs";
import * as Rating from "../../lib/Rating.re.mjs";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Float from "@rescript/core/src/Core__Float.re.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.re.mjs";
import * as Core__Result from "@rescript/core/src/Core__Result.re.mjs";
import * as LucideReact from "lucide-react";
import * as ReactHookForm from "react-hook-form";
import * as JsxRuntime from "react/jsx-runtime";
import * as Zod$1 from "@hookform/resolvers/zod";

import { t } from '@lingui/macro'
;

var ControllerOfInputsMatch = {};

var schema = Zod.z.object({
      scoreLeft: Zod.z.preprocess((function (a) {
              return Core__Option.getOr(Core__Float.fromString(a), 0);
            }), Zod.z.number({
                  invalid_type_error: "Enter a number"
                }).gte(0)),
      scoreRight: Zod.z.preprocess((function (a) {
              return Core__Option.getOr(Core__Float.fromString(a), 0);
            }), Zod.z.number({
                  invalid_type_error: "Enter a number"
                }).gte(0))
    });

function MatchCardEdit(props) {
  var onCancel = props.onCancel;
  var onSave = props.onSave;
  var match = props.match;
  var team2 = match[1];
  var team1 = match[0];
  var doublesMatch = Rating.DoublesMatch.fromMatch(match);
  var ratedMatch = Core__Result.flatMap(doublesMatch, (function (param) {
          var match = param[1];
          var match$1 = param[0];
          var match$2 = match$1[0].data;
          var match$3 = match$1[1].data;
          var match$4 = match[0].data;
          var match$5 = match[1].data;
          if (match$2 !== undefined && match$3 !== undefined && match$4 !== undefined && match$5 !== undefined) {
            return {
                    TAG: "Ok",
                    _0: undefined
                  };
          } else {
            return {
                    TAG: "Error",
                    _0: "TwoPlayersRequired"
                  };
          }
        }));
  var match$1 = Core__Option.getOr(props.score, [
        0,
        0
      ]);
  var match$2 = ReactHookForm.useForm({
        resolver: Caml_option.some(Zod$1.zodResolver(schema)),
        defaultValues: {
          scoreLeft: match$1[0],
          scoreRight: match$1[1]
        }
      });
  var watch = match$2.watch;
  var register = match$2.register;
  var match$3 = watch("scoreLeft");
  var scoreLeftValue;
  if (match$3 !== undefined) {
    if (!Array.isArray(match$3) && (match$3 === null || typeof match$3 !== "object") && typeof match$3 !== "string" && typeof match$3 !== "number" && typeof match$3 !== "boolean") {
      scoreLeftValue = 0;
    } else {
      switch (typeof match$3) {
        case "number" :
            scoreLeftValue = match$3;
            break;
        case "string" :
            scoreLeftValue = Core__Option.getOr(Core__Float.fromString(match$3), 0);
            break;
        default:
          scoreLeftValue = 0;
      }
    }
  } else {
    scoreLeftValue = 0;
  }
  var match$4 = watch("scoreRight");
  var scoreRightValue;
  if (match$4 !== undefined) {
    if (!Array.isArray(match$4) && (match$4 === null || typeof match$4 !== "object") && typeof match$4 !== "string" && typeof match$4 !== "number" && typeof match$4 !== "boolean") {
      scoreRightValue = 0;
    } else {
      switch (typeof match$4) {
        case "number" :
            scoreRightValue = match$4;
            break;
        case "string" :
            scoreRightValue = Core__Option.getOr(Core__Float.fromString(match$4), 0);
            break;
        default:
          scoreRightValue = 0;
      }
    }
  } else {
    scoreRightValue = 0;
  }
  var handleSave = function () {
    var match = [
      team1,
      team2
    ];
    var scoreData = [
      scoreLeftValue,
      scoreRightValue
    ];
    var hasWinner = scoreLeftValue !== scoreRightValue && (scoreLeftValue !== 0 || scoreRightValue !== 0);
    onSave([
          match,
          Core__Result.isOk(ratedMatch) && hasWinner ? scoreData : undefined
        ]);
  };
  return JsxRuntime.jsxs("div", {
              children: [
                JsxRuntime.jsxs("div", {
                      children: [
                        JsxRuntime.jsx("span", {
                              children: t`Court ${props.courtNumber.toString()} - Editing`,
                              className: "text-xs font-semibold text-blue-900"
                            }),
                        JsxRuntime.jsxs("div", {
                              children: [
                                Core__Option.getOr(Core__Option.map(props.onDelete, (function (deleteFn) {
                                            return JsxRuntime.jsx("button", {
                                                        children: JsxRuntime.jsx(LucideReact.Trash2, {
                                                              className: "w-4 h-4"
                                                            }),
                                                        "aria-label": t`Delete match`,
                                                        className: "p-1 text-red-700 hover:bg-red-200 rounded transition-colors",
                                                        onClick: (function (param) {
                                                            deleteFn();
                                                          })
                                                      });
                                          })), null),
                                JsxRuntime.jsx("button", {
                                      children: JsxRuntime.jsx(LucideReact.Check, {
                                            className: "w-4 h-4"
                                          }),
                                      "aria-label": t`Save`,
                                      className: "p-1 text-green-700 hover:bg-green-200 rounded transition-colors",
                                      onClick: (function (param) {
                                          handleSave();
                                          onCancel();
                                        })
                                    })
                              ],
                              className: "flex items-center gap-1"
                            })
                      ],
                      className: "bg-blue-100 px-2 py-1 border-b border-blue-200 flex items-center justify-between"
                    }),
                JsxRuntime.jsxs("div", {
                      children: [
                        JsxRuntime.jsxs("div", {
                              children: [
                                JsxRuntime.jsxs("div", {
                                      children: [
                                        JsxRuntime.jsx("div", {
                                              children: t`TEAM 1`,
                                              className: "text-xs font-semibold text-slate-600"
                                            }),
                                        JsxRuntime.jsx(Form.Input.make, {
                                              className: "w-16 px-2 py-1 text-sm text-center border border-slate-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",
                                              id: "scoreLeft",
                                              type_: "number",
                                              placeholder: t`Score`,
                                              register: register("scoreLeft", undefined),
                                              pattern: "[0-9]*",
                                              inputMode: "numeric"
                                            })
                                      ],
                                      className: "flex items-center justify-between mb-2"
                                    }),
                                JsxRuntime.jsx("div", {
                                      children: props.team1Element,
                                      className: "space-y-2"
                                    })
                              ],
                              className: "p-2 bg-slate-50 flex-1 border-b border-slate-200"
                            }),
                        JsxRuntime.jsx("div", {
                              children: JsxRuntime.jsx("div", {
                                    children: JsxRuntime.jsx("span", {
                                          children: t`VS`,
                                          className: "bg-slate-50 px-2 text-xs font-bold text-slate-400"
                                        }),
                                    className: "absolute inset-0 flex items-center justify-center border-b border-slate-200"
                                  }),
                              className: "relative flex items-center justify-center bg-slate-50"
                            }),
                        JsxRuntime.jsxs("div", {
                              children: [
                                JsxRuntime.jsxs("div", {
                                      children: [
                                        JsxRuntime.jsx("div", {
                                              children: t`TEAM 2`,
                                              className: "text-xs font-semibold text-slate-600"
                                            }),
                                        JsxRuntime.jsx(Form.Input.make, {
                                              className: "w-16 px-2 py-1 text-sm text-center border border-slate-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",
                                              id: "scoreRight",
                                              type_: "number",
                                              placeholder: t`Score`,
                                              register: register("scoreRight", undefined),
                                              pattern: "[0-9]*",
                                              inputMode: "numeric"
                                            })
                                      ],
                                      className: "flex items-center justify-between mb-2"
                                    }),
                                JsxRuntime.jsx("div", {
                                      children: props.team2Element,
                                      className: "space-y-2"
                                    })
                              ],
                              className: "p-2 bg-slate-50 flex-1"
                            })
                      ],
                      className: "flex flex-col"
                    })
              ],
              className: "bg-white rounded-lg border-2 border-blue-500 shadow-sm overflow-hidden"
            });
}

var make = MatchCardEdit;

export {
  ControllerOfInputsMatch ,
  schema ,
  make ,
}
/*  Not a pure module */

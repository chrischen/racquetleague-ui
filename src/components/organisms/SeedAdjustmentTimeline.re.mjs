// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Js_dict from "rescript/lib/es6/js_dict.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Array from "@rescript/core/src/Core__Array.re.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.re.mjs";
import * as LucideReact from "lucide-react";
import * as JsxRuntime from "react/jsx-runtime";
import * as RescriptRelay_Fragment from "rescript-relay/src/RescriptRelay_Fragment.re.mjs";
import * as SeedAdjustmentTimeline_user_graphql from "../../__generated__/SeedAdjustmentTimeline_user_graphql.re.mjs";

import { t } from '@lingui/macro'
;

var convertFragment = SeedAdjustmentTimeline_user_graphql.Internal.convertFragment;

function use(fRef) {
  return RescriptRelay_Fragment.useFragment(SeedAdjustmentTimeline_user_graphql.node, convertFragment, fRef);
}

function useOpt(fRef) {
  return RescriptRelay_Fragment.useFragmentOpt(fRef !== undefined ? Caml_option.some(Caml_option.valFromOption(fRef)) : undefined, SeedAdjustmentTimeline_user_graphql.node, convertFragment);
}

var Fragment = {
  Types: undefined,
  Operation: undefined,
  convertFragment: convertFragment,
  use: use,
  useOpt: useOpt
};

function SeedAdjustmentTimeline$PlayerAvatar(props) {
  var name = props.name;
  var pictureUrl = Core__Option.flatMap(props.userFragmentRefs, (function (fragmentRefs) {
          return use(fragmentRefs).picture;
        }));
  return Core__Option.getOr(Core__Option.map(pictureUrl, (function (url) {
                    return JsxRuntime.jsx("img", {
                                className: "w-7 h-7 rounded-full object-cover flex-shrink-0",
                                alt: name,
                                src: url
                              });
                  })), JsxRuntime.jsx("div", {
                  children: JsxRuntime.jsx("span", {
                        children: name.charAt(0),
                        className: "text-xs font-semibold text-slate-600"
                      }),
                  className: "w-7 h-7 rounded-full bg-slate-200 flex-shrink-0 flex items-center justify-center"
                }));
}

var PlayerAvatar = {
  make: SeedAdjustmentTimeline$PlayerAvatar
};

function SeedAdjustmentTimeline(props) {
  var onDelete = props.onDelete;
  var getUserFragmentRefs = props.getUserFragmentRefs;
  var playersCache = props.playersCache;
  var adjustments = props.adjustments;
  var handleDelete = function (e) {
    e.stopPropagation();
    onDelete();
  };
  var match = React.useState(function () {
        return false;
      });
  var setIsExpanded = match[1];
  var isExpanded = match[0];
  var changes = React.useMemo((function () {
          return Core__Array.filterMap(adjustments.map(function (adj) {
                          var player = Js_dict.get(playersCache, adj.playerId);
                          return Core__Option.map(player, (function (p) {
                                        return {
                                                player: p,
                                                differential: adj.differential
                                              };
                                      }));
                        }), (function (x) {
                        return x;
                      }));
        }), [
        adjustments,
        playersCache
      ]);
  var upCount = changes.filter(function (c) {
        return c.differential > 0;
      }).length;
  var downCount = changes.filter(function (c) {
        return c.differential < 0;
      }).length;
  return JsxRuntime.jsxs("div", {
              children: [
                JsxRuntime.jsx("div", {
                      children: JsxRuntime.jsx("div", {
                            className: "w-full border-t border-slate-300"
                          }),
                      "aria-hidden": true,
                      className: "absolute inset-0 flex items-center"
                    }),
                JsxRuntime.jsx("div", {
                      children: JsxRuntime.jsx("div", {
                            children: JsxRuntime.jsxs("div", {
                                  children: [
                                    JsxRuntime.jsxs("div", {
                                          children: [
                                            JsxRuntime.jsxs("button", {
                                                  children: [
                                                    JsxRuntime.jsx("div", {
                                                          children: JsxRuntime.jsx(LucideReact.ArrowUpCircle, {
                                                                className: "w-3 h-3 text-amber-700"
                                                              }),
                                                          className: "w-6 h-6 rounded-full bg-amber-100 flex items-center justify-center flex-shrink-0"
                                                        }),
                                                    JsxRuntime.jsxs("div", {
                                                          children: [
                                                            JsxRuntime.jsx("h3", {
                                                                  children: t`Seeds Adjusted`,
                                                                  className: "text-xs font-bold text-slate-900"
                                                                }),
                                                            JsxRuntime.jsxs("p", {
                                                                  children: [
                                                                    changes.length.toString() + " player" + (
                                                                      changes.length !== 1 ? "s" : ""
                                                                    ),
                                                                    upCount > 0 ? JsxRuntime.jsx("span", {
                                                                            children: "↑" + upCount.toString(),
                                                                            className: "ml-1 text-green-600"
                                                                          }) : null,
                                                                    downCount > 0 ? JsxRuntime.jsx("span", {
                                                                            children: "↓" + downCount.toString(),
                                                                            className: "ml-1 text-red-600"
                                                                          }) : null
                                                                  ],
                                                                  className: "text-xs text-slate-600"
                                                                })
                                                          ],
                                                          className: "text-left"
                                                        })
                                                  ],
                                                  className: "flex items-center gap-2 flex-1 text-left",
                                                  onClick: (function (param) {
                                                      setIsExpanded(function (prev) {
                                                            return !prev;
                                                          });
                                                    })
                                                }),
                                            JsxRuntime.jsxs("div", {
                                                  children: [
                                                    isExpanded ? JsxRuntime.jsx("button", {
                                                            children: JsxRuntime.jsx(LucideReact.Trash2, {
                                                                  className: "w-3.5 h-3.5 text-red-600"
                                                                }),
                                                            className: "p-1.5 hover:bg-red-100 rounded transition-colors",
                                                            title: "Delete seed adjustment",
                                                            onClick: handleDelete
                                                          }) : null,
                                                    JsxRuntime.jsx("button", {
                                                          children: JsxRuntime.jsx(LucideReact.ChevronDown, {
                                                                className: "w-4 h-4 text-slate-400 transition-transform " + (
                                                                  isExpanded ? "rotate-180" : ""
                                                                )
                                                              }),
                                                          className: "p-1 hover:bg-slate-100 rounded transition-colors",
                                                          onClick: (function (param) {
                                                              setIsExpanded(function (prev) {
                                                                    return !prev;
                                                                  });
                                                            })
                                                        })
                                                  ],
                                                  className: "flex items-center gap-2"
                                                })
                                          ],
                                          className: "flex items-center justify-between px-3 py-2"
                                        }),
                                    isExpanded ? JsxRuntime.jsx("div", {
                                            children: JsxRuntime.jsx("div", {
                                                  children: changes.map(function (change) {
                                                        var isUp = change.differential > 0;
                                                        var isDown = change.differential < 0;
                                                        var movementAmount = Math.abs(change.differential);
                                                        return JsxRuntime.jsxs("div", {
                                                                    children: [
                                                                      Core__Option.getOr(Core__Option.map(Core__Option.flatMap(change.player.data, getUserFragmentRefs), (function (userFragmentRefs) {
                                                                                  return JsxRuntime.jsx(SeedAdjustmentTimeline$PlayerAvatar, {
                                                                                              userFragmentRefs: Caml_option.some(userFragmentRefs),
                                                                                              name: change.player.name
                                                                                            });
                                                                                })), JsxRuntime.jsx(SeedAdjustmentTimeline$PlayerAvatar, {
                                                                                userFragmentRefs: undefined,
                                                                                name: change.player.name
                                                                              })),
                                                                      JsxRuntime.jsxs("div", {
                                                                            children: [
                                                                              JsxRuntime.jsx("div", {
                                                                                    children: change.player.name,
                                                                                    className: "text-xs font-semibold text-slate-800 truncate"
                                                                                  }),
                                                                              JsxRuntime.jsxs("div", {
                                                                                    children: [
                                                                                      isUp ? JsxRuntime.jsxs("div", {
                                                                                              children: [
                                                                                                JsxRuntime.jsx(LucideReact.ChevronUp, {
                                                                                                      className: "w-3 h-3"
                                                                                                    }),
                                                                                                JsxRuntime.jsx("span", {
                                                                                                      children: movementAmount.toFixed(1),
                                                                                                      className: "text-xs font-bold"
                                                                                                    })
                                                                                              ],
                                                                                              className: "flex items-center gap-0.5 text-green-600"
                                                                                            }) : null,
                                                                                      isDown ? JsxRuntime.jsxs("div", {
                                                                                              children: [
                                                                                                JsxRuntime.jsx(LucideReact.ChevronDown, {
                                                                                                      className: "w-3 h-3"
                                                                                                    }),
                                                                                                JsxRuntime.jsx("span", {
                                                                                                      children: movementAmount.toFixed(1),
                                                                                                      className: "text-xs font-bold"
                                                                                                    })
                                                                                              ],
                                                                                              className: "flex items-center gap-0.5 text-red-600"
                                                                                            }) : null,
                                                                                      !isUp && !isDown ? JsxRuntime.jsx("span", {
                                                                                              children: "—",
                                                                                              className: "text-xs text-slate-400"
                                                                                            }) : null
                                                                                    ],
                                                                                    className: "flex items-center gap-1"
                                                                                  })
                                                                            ],
                                                                            className: "flex-1 min-w-0"
                                                                          })
                                                                    ],
                                                                    className: "flex items-center gap-2 p-2 bg-slate-50 rounded border border-slate-200"
                                                                  }, change.player.id);
                                                      }),
                                                  className: "grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2"
                                                }),
                                            className: "px-3 pb-3 pt-2 border-t border-amber-200"
                                          }) : null
                                  ],
                                  className: "bg-white rounded-lg border border-amber-300 shadow-sm hover:bg-amber-50 transition-colors w-full max-w-4xl"
                                }),
                            className: "bg-slate-50 px-4"
                          }),
                      className: "relative flex justify-center"
                    })
              ],
              className: "my-4 relative"
            });
}

var make = SeedAdjustmentTimeline;

export {
  Fragment ,
  PlayerAvatar ,
  make ,
}
/*  Not a pure module */

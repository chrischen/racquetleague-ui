// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Rating from "../../lib/Rating.re.mjs";
import * as Js_dict from "rescript/lib/es6/js_dict.js";
import * as UiAction from "../atoms/UiAction.re.mjs";
import * as Core__Int from "@rescript/core/src/Core__Int.re.mjs";
import * as MatchCard from "./MatchCard.re.mjs";
import * as PlayerRow from "../molecules/PlayerRow.re.mjs";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Array from "@rescript/core/src/Core__Array.re.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.re.mjs";
import * as Core__String from "@rescript/core/src/Core__String.re.mjs";
import * as PlayerAvatar from "./PlayerAvatar.re.mjs";
import * as LucideReact from "lucide-react";
import * as Core from "@dnd-kit/core";
import * as Caml_splice_call from "rescript/lib/es6/caml_splice_call.js";
import * as JsxRuntime from "react/jsx-runtime";
import * as MultipleContainers from "../dndkit/MultipleContainers.re.mjs";
import * as PlayerReplaceModal from "../molecules/PlayerReplaceModal.re.mjs";

import { t, plural } from '@lingui/macro'
;

function t$1(prim0, prim1) {
  return Caml_splice_call.spliceApply(t, [
              prim0,
              prim1
            ]);
}

function getTeamSignature(players) {
  return players.map(function (p) {
                  return p.id;
                }).toSorted(function (a, b) {
                return Core__String.compare(a, b);
              }).join(",");
}

function getMatchSignature(match) {
  var sig1 = getTeamSignature(match[0]);
  var sig2 = getTeamSignature(match[1]);
  return [
              sig1,
              sig2
            ].toSorted(Core__String.compare).join("|");
}

function checkTeamHistory(teamSig, currentRoundIdx, allRounds) {
  var foundInLastRound;
  if (currentRoundIdx > 0) {
    var lastRound = Core__Option.getOr(allRounds[currentRoundIdx - 1 | 0], []);
    foundInLastRound = lastRound.some(function (param) {
          var match = param.match;
          if (getTeamSignature(match[0]) === teamSig) {
            return true;
          } else {
            return getTeamSignature(match[1]) === teamSig;
          }
        });
  } else {
    foundInLastRound = false;
  }
  if (foundInLastRound) {
    return "LastRound";
  }
  var foundInPrevious = allRounds.slice(0).filter(function (param, idx) {
          return idx < (currentRoundIdx - 1 | 0);
        }).some(function (round) {
        return round.some(function (param) {
                    var match = param.match;
                    if (getTeamSignature(match[0]) === teamSig) {
                      return true;
                    } else {
                      return getTeamSignature(match[1]) === teamSig;
                    }
                  });
      });
  if (foundInPrevious) {
    return "PreviousRound";
  } else {
    return "NoHistory";
  }
}

function checkMatchHistory(matchSig, currentRoundIdx, allRounds) {
  var foundInLastRound;
  if (currentRoundIdx > 0) {
    var lastRound = Core__Option.getOr(allRounds[currentRoundIdx - 1 | 0], []);
    foundInLastRound = lastRound.some(function (param) {
          return getMatchSignature(param.match) === matchSig;
        });
  } else {
    foundInLastRound = false;
  }
  if (foundInLastRound) {
    return "LastRound";
  }
  var foundInPrevious = allRounds.slice(0).filter(function (param, idx) {
          return idx < (currentRoundIdx - 1 | 0);
        }).some(function (round) {
        return round.some(function (param) {
                    return getMatchSignature(param.match) === matchSig;
                  });
      });
  if (foundInPrevious) {
    return "PreviousRound";
  } else {
    return "NoHistory";
  }
}

var HistoryCalculator = {
  getTeamSignature: getTeamSignature,
  getMatchSignature: getMatchSignature,
  checkTeamHistory: checkTeamHistory,
  checkMatchHistory: checkMatchHistory
};

function RoundSection$AverageQualityDebug(props) {
  var matches = props.matches;
  var matchCount = matches.length;
  var averageQuality;
  if (matchCount > 0) {
    var totalQuality = Core__Array.reduce(matches, 0, (function (acc, param) {
            var match = param.match;
            var quality = Rating.Rating.predictDraw([
                  match[0].map(function (p) {
                        return p.rating;
                      }),
                  match[1].map(function (p) {
                        return p.rating;
                      })
                ]);
            return acc + quality;
          }));
    averageQuality = totalQuality / matchCount;
  } else {
    averageQuality = 0;
  }
  return JsxRuntime.jsx("span", {
              children: "Avg Q: " + averageQuality.toFixed(3),
              className: "text-xs font-mono " + (
                props.isCurrentRound ? "text-blue-600" : "text-slate-400"
              )
            });
}

var AverageQualityDebug = {
  make: RoundSection$AverageQualityDebug
};

function RoundSection(props) {
  var allRounds = props.allRounds;
  var getUserFragmentRefs = props.getUserFragmentRefs;
  var __debug = props.debug;
  var onReset = props.onReset;
  var onRebalanceMatch = props.onRebalanceMatch;
  var onRebalance = props.onRebalance;
  var setShowMatchSelector = props.setShowMatchSelector;
  var setRequiredPlayers = props.setRequiredPlayers;
  var setQueue = props.setQueue;
  var setMatches = props.setMatches;
  var handleMatchUpdated = props.handleMatchUpdated;
  var handleMatchCanceled = props.handleMatchCanceled;
  var checkedInPlayerIds = props.checkedInPlayerIds;
  var playersCache = props.playersCache;
  var isPastRound = props.isPastRound;
  var isCurrentRound = props.isCurrentRound;
  var roundNumber = props.roundNumber;
  var matches = props.matches;
  var debug = __debug !== undefined ? __debug : false;
  var matchCount = matches.length;
  var matchText = plural(matchCount, {
        one: t`match`,
        other: t`matches`
      });
  var match = React.useState(function () {
        
      });
  var setReplacementState = match[1];
  var replacementState = match[0];
  var match$1 = React.useState(function () {
        return !isPastRound;
      });
  var setIsExpanded = match$1[1];
  var isExpanded = match$1[0];
  var checkedInPlayers = React.useMemo((function () {
          return Js_dict.values(playersCache).filter(function (p) {
                      return checkedInPlayerIds.has(p.id);
                    });
        }), [
        playersCache,
        checkedInPlayerIds
      ]);
  var consumedPlayers = React.useMemo((function () {
          return new Set(matches.flatMap(function (param) {
                            var m = param.match;
                            return m[0].concat(m[1]);
                          }).map(function (p) {
                          return p.id;
                        }));
        }), [matches]);
  var standbyPlayers = React.useMemo((function () {
          return checkedInPlayers.filter(function (p) {
                      return !consumedPlayers.has(p.id);
                    });
        }), [
        checkedInPlayers,
        consumedPlayers
      ]);
  var handlePlayerSelect = function (newPlayer) {
    Core__Option.map(replacementState, (function (param) {
            var playerIndex = param.playerIndex;
            var matchId = param.matchId;
            setMatches(function (matches) {
                  return matches.map(function (matchEntity) {
                              if (matchEntity.id !== matchId) {
                                return matchEntity;
                              }
                              var match = matchEntity.match;
                              var team1 = match[0];
                              var allPlayers = team1.concat(match[1]);
                              var updatedPlayers = allPlayers.map(function (p, i) {
                                    if (i === playerIndex) {
                                      return newPlayer;
                                    } else {
                                      return p;
                                    }
                                  });
                              var team1Size = team1.length;
                              var newTeam1 = updatedPlayers.slice(0, team1Size);
                              var newTeam2 = updatedPlayers.slice(team1Size);
                              return {
                                      id: matchEntity.id,
                                      match: [
                                        newTeam1,
                                        newTeam2
                                      ],
                                      score: matchEntity.score,
                                      createdAt: matchEntity.createdAt
                                    };
                            });
                });
          }));
    setReplacementState(function (param) {
          
        });
  };
  var handleCloseReplaceModal = function () {
    setReplacementState(function (param) {
          
        });
  };
  var findPlayerInMatches = function (playerId) {
    return Core__Option.flatMap(Core__Array.findIndexOpt(matches, (function (param) {
                      var m = param.match;
                      return m[0].concat(m[1]).some(function (p) {
                                  return p.id === playerId;
                                });
                    })), (function (matchIndex) {
                  var matchEntity = matches[matchIndex];
                  var match = matchEntity.match;
                  var allPlayers = match[0].concat(match[1]);
                  return Core__Option.map(Core__Array.findIndexOpt(allPlayers, (function (p) {
                                    return p.id === playerId;
                                  })), (function (playerIndex) {
                                return [
                                        matchEntity.id,
                                        playerIndex
                                      ];
                              }));
                }));
  };
  React.useEffect((function () {
          if (isCurrentRound) {
            setIsExpanded(function (param) {
                  return true;
                });
          } else if (isPastRound) {
            setIsExpanded(function (param) {
                  return false;
                });
          }
          
        }), [
        isCurrentRound,
        isPastRound
      ]);
  var minRating = Core__Array.reduce(matches.flatMap(function (param) {
              var m = param.match;
              return m[0].concat(m[1]);
            }).map(function (p) {
            return p.rating.mu;
          }), 100, (function (acc, next) {
          if (next < acc) {
            return next;
          } else {
            return acc;
          }
        }));
  var maxRating = Core__Array.reduce(matches.flatMap(function (param) {
              var m = param.match;
              return m[0].concat(m[1]);
            }).map(function (p) {
            return p.rating.mu;
          }), 0, (function (acc, next) {
          if (next > acc) {
            return next;
          } else {
            return acc;
          }
        }));
  var currentRoundIdx = roundNumber - 1 | 0;
  var matchesGrid = isCurrentRound ? JsxRuntime.jsx(Core.DndContext, {
          children: JsxRuntime.jsx("div", {
                children: JsxRuntime.jsx(MultipleContainers.make, {
                      items: Rating.Matches.toDndItems(matches.map(function (param) {
                                return param.match;
                              })),
                      minimal: true,
                      setItems: (function (updateFn) {
                          setMatches(function (matches) {
                                var matchesOnly = matches.map(function (param) {
                                      return param.match;
                                    });
                                var items = Rating.Matches.toDndItems(matchesOnly);
                                var updatedMatches = Rating.Matches.fromDndItems(updateFn(items), playersCache);
                                return matches.map(function (entity, i) {
                                            var newMatch = updatedMatches[i];
                                            return {
                                                    id: entity.id,
                                                    match: newMatch,
                                                    score: entity.score,
                                                    createdAt: entity.createdAt
                                                  };
                                          });
                              });
                        }),
                      deleteContainer: (function (i) {
                          handleMatchCanceled(i);
                        }),
                      renderContainer: (function (children, matchIndex) {
                          return Core__Option.getOr(Core__Option.map(matches[matchIndex], (function (param) {
                                            var match = param.match;
                                            var matchId = param.id;
                                            var courtNumber = matchIndex + 1 | 0;
                                            var team1Sig = getTeamSignature(match[0]);
                                            var team2Sig = getTeamSignature(match[1]);
                                            var matchSig = getMatchSignature(match);
                                            var team1History = checkTeamHistory(team1Sig, currentRoundIdx, allRounds);
                                            var team2History = checkTeamHistory(team2Sig, currentRoundIdx, allRounds);
                                            var matchHistory = checkMatchHistory(matchSig, currentRoundIdx, allRounds);
                                            return JsxRuntime.jsx(MatchCard.make, {
                                                        children: children,
                                                        match: match,
                                                        courtNumber: courtNumber,
                                                        minRating: minRating,
                                                        maxRating: maxRating,
                                                        score: param.score,
                                                        onDelete: (function () {
                                                            handleMatchCanceled(matchId);
                                                          }),
                                                        onRebalance: Core__Option.map(onRebalanceMatch, (function (fn) {
                                                                return function () {
                                                                  fn(matchId);
                                                                };
                                                              })),
                                                        onUpdated: (function (completedMatch) {
                                                            handleMatchUpdated(completedMatch, matchId);
                                                          }),
                                                        debug: debug,
                                                        getUserFragmentRefs: getUserFragmentRefs,
                                                        team1History: team1History,
                                                        team2History: team2History,
                                                        matchHistory: matchHistory
                                                      }, matchId);
                                          })), null);
                        }),
                      renderValue: (function (value) {
                          var match = value.split(":");
                          var value$1;
                          if (match.length !== 2) {
                            value$1 = undefined;
                          } else {
                            var ids = match[0];
                            var id = match[1];
                            var match$1 = ids.split(".");
                            if (match$1.length !== 2) {
                              value$1 = undefined;
                            } else {
                              var matchId = match$1[0];
                              value$1 = [
                                matchId,
                                id
                              ];
                            }
                          }
                          var player = Core__Option.flatMap(value$1, (function (param) {
                                  var matchId = param[0];
                                  return Core__Option.flatMap(Rating.PlayersCache.get(playersCache, param[1]), (function (player) {
                                                return Core__Option.map(Core__Int.fromString(matchId, undefined), (function (matchId) {
                                                              return [
                                                                      matchId,
                                                                      player
                                                                    ];
                                                            }));
                                              }));
                                }));
                          return Core__Option.getOr(Core__Option.map(player, (function (param) {
                                            var player = param[1];
                                            var matchId = param[0];
                                            var skillLevel = maxRating === minRating ? 50 : (player.rating.mu - minRating) / (maxRating - minRating) * 100;
                                            return JsxRuntime.jsx(UiAction.make, {
                                                        onClick: (function (param) {
                                                            var matchEntity = matches[matchId];
                                                            Core__Option.map(matchEntity, (function (param) {
                                                                    var matchPlayers = Rating.Match.players(param.match).map(function (player) {
                                                                            return player.id;
                                                                          }).filter(function (p) {
                                                                          return p !== player.id;
                                                                        });
                                                                    var replacements = new Set(checkedInPlayers.map(function (player) {
                                                                                return player.id;
                                                                              })).difference(consumedPlayers);
                                                                    var newQueue = matchPlayers.concat(Array.from(replacements.values()));
                                                                    setRequiredPlayers(function (param) {
                                                                          return Caml_option.some(new Set(matchPlayers));
                                                                        });
                                                                    setQueue(newQueue);
                                                                  }));
                                                            setShowMatchSelector(function (param) {
                                                                  return true;
                                                                });
                                                          }),
                                                        className: "w-full",
                                                        children: JsxRuntime.jsx(PlayerRow.make, {
                                                              player: player,
                                                              isEditing: true,
                                                              teamSide: "Left",
                                                              skillLevel: skillLevel,
                                                              getUserFragmentRefs: getUserFragmentRefs,
                                                              onClick: (function () {
                                                                  Core__Option.map(findPlayerInMatches(player.id), (function (param) {
                                                                          var matchId = param[0];
                                                                          var playerIndex = param[1];
                                                                          setReplacementState(function (param) {
                                                                                return {
                                                                                        matchId: matchId,
                                                                                        playerIndex: playerIndex,
                                                                                        player: player
                                                                                      };
                                                                              });
                                                                        }));
                                                                })
                                                            })
                                                      });
                                          })), null);
                        })
                    }),
                className: "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"
              }),
          onDragEnd: (function (param) {
              
            })
        }) : JsxRuntime.jsx("div", {
          children: matches.map(function (matchEntity, matchIndex) {
                var match = matchEntity.match;
                var matchId = matchEntity.id;
                var courtNumber = matchIndex + 1 | 0;
                var team1Sig = getTeamSignature(match[0]);
                var team2Sig = getTeamSignature(match[1]);
                var matchSig = getMatchSignature(match);
                var team1History = checkTeamHistory(team1Sig, currentRoundIdx, allRounds);
                var team2History = checkTeamHistory(team2Sig, currentRoundIdx, allRounds);
                var matchHistory = checkMatchHistory(matchSig, currentRoundIdx, allRounds);
                return JsxRuntime.jsx(MatchCard.make, {
                            children: [],
                            match: match,
                            courtNumber: courtNumber,
                            minRating: minRating,
                            maxRating: maxRating,
                            score: matchEntity.score,
                            onDelete: (function () {
                                
                              }),
                            onRebalance: Core__Option.map(onRebalanceMatch, (function (fn) {
                                    return function () {
                                      fn(matchId);
                                    };
                                  })),
                            onUpdated: (function (param) {
                                
                              }),
                            debug: debug,
                            getUserFragmentRefs: getUserFragmentRefs,
                            team1History: team1History,
                            team2History: team2History,
                            matchHistory: matchHistory
                          }, matchId);
              }),
          className: "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"
        });
  var displayedPlayers = standbyPlayers.slice(0, 5);
  var remainingCount = standbyPlayers.length - 5 | 0;
  var match$2 = React.useState(function () {
        return false;
      });
  var setShowAllNotPlaying = match$2[1];
  var showAllNotPlaying = match$2[0];
  return JsxRuntime.jsxs("div", {
              children: [
                isCurrentRound ? JsxRuntime.jsxs("div", {
                        children: [
                          JsxRuntime.jsxs("div", {
                                children: [
                                  JsxRuntime.jsx("h2", {
                                        children: t`Round ${roundNumber.toString()}`,
                                        className: "text-xl font-bold text-blue-900"
                                      }),
                                  JsxRuntime.jsx("span", {
                                        children: t`ACTIVE ROUND`,
                                        className: "px-3 py-1 text-sm font-bold text-white bg-blue-600 rounded-full shadow-md"
                                      }),
                                  JsxRuntime.jsx("span", {
                                        children: t`${matchCount.toString()} ${matchText}`,
                                        className: "text-sm text-blue-700"
                                      }),
                                  debug ? JsxRuntime.jsx(RoundSection$AverageQualityDebug, {
                                          matches: matches,
                                          isCurrentRound: isCurrentRound
                                        }) : null
                                ],
                                className: "flex items-center gap-3 flex-wrap"
                              }),
                          JsxRuntime.jsxs("div", {
                                children: [
                                  Core__Option.isSome(onRebalance) ? JsxRuntime.jsx("div", {
                                          children: JsxRuntime.jsx(LucideReact.Shuffle, {
                                                className: "w-5 h-5 text-blue-600"
                                              }),
                                          className: "p-2 hover:bg-blue-100 rounded-lg transition-colors cursor-pointer",
                                          role: "button",
                                          tabIndex: 0,
                                          title: t`Rebalance this round with current players`,
                                          onKeyDown: (function (e) {
                                              if (e.key === "Enter" || e.key === " ") {
                                                e.preventDefault();
                                                e.stopPropagation();
                                                return Core__Option.forEach(onRebalance, (function (fn) {
                                                              fn();
                                                            }));
                                              }
                                              
                                            }),
                                          onClick: (function (e) {
                                              e.stopPropagation();
                                              Core__Option.forEach(onRebalance, (function (fn) {
                                                      fn();
                                                    }));
                                            })
                                        }) : null,
                                  Core__Option.isSome(onReset) ? JsxRuntime.jsxs(JsxRuntime.Fragment, {
                                          children: [
                                            JsxRuntime.jsxs("div", {
                                                  children: [
                                                    JsxRuntime.jsx(LucideReact.Mars, {
                                                          className: "w-4 h-4 text-blue-600"
                                                        }),
                                                    JsxRuntime.jsx(LucideReact.Venus, {
                                                          className: "w-4 h-4 text-pink-600"
                                                        })
                                                  ],
                                                  className: "p-2 hover:bg-purple-100 rounded-lg transition-colors cursor-pointer flex items-center gap-0.5",
                                                  role: "button",
                                                  tabIndex: 0,
                                                  title: t`Reset this round with mixed gender pairs`,
                                                  onKeyDown: (function (e) {
                                                      if (e.key === "Enter" || e.key === " ") {
                                                        e.preventDefault();
                                                        e.stopPropagation();
                                                        return Core__Option.forEach(onReset, (function (fn) {
                                                                      fn(true);
                                                                    }));
                                                      }
                                                      
                                                    }),
                                                  onClick: (function (e) {
                                                      e.stopPropagation();
                                                      Core__Option.forEach(onReset, (function (fn) {
                                                              fn(true);
                                                            }));
                                                    })
                                                }),
                                            JsxRuntime.jsx("div", {
                                                  children: JsxRuntime.jsx(LucideReact.RotateCcw, {
                                                        className: "w-5 h-5 text-red-600"
                                                      }),
                                                  className: "p-2 hover:bg-red-100 rounded-lg transition-colors cursor-pointer",
                                                  role: "button",
                                                  tabIndex: 0,
                                                  title: t`Reset this round with all checked-in players`,
                                                  onKeyDown: (function (e) {
                                                      if (e.key === "Enter" || e.key === " ") {
                                                        e.preventDefault();
                                                        e.stopPropagation();
                                                        return Core__Option.forEach(onReset, (function (fn) {
                                                                      fn(false);
                                                                    }));
                                                      }
                                                      
                                                    }),
                                                  onClick: (function (e) {
                                                      e.stopPropagation();
                                                      Core__Option.forEach(onReset, (function (fn) {
                                                              fn(false);
                                                            }));
                                                    })
                                                })
                                          ]
                                        }) : null
                                ],
                                className: "flex items-center gap-2"
                              })
                        ],
                        className: "flex items-center justify-between gap-3 mb-3 flex-wrap"
                      }) : JsxRuntime.jsxs("button", {
                        children: [
                          JsxRuntime.jsxs("div", {
                                children: [
                                  JsxRuntime.jsx("h2", {
                                        children: t`Round ${roundNumber.toString()}`,
                                        className: "text-xl font-bold text-slate-800 flex-shrink-0"
                                      }),
                                  JsxRuntime.jsx("span", {
                                        children: t`${matchCount.toString()} ${matchText}`,
                                        className: "text-sm text-slate-500 flex-shrink-0"
                                      })
                                ],
                                className: "flex items-center gap-3 min-w-0"
                              }),
                          JsxRuntime.jsx(LucideReact.ChevronDown, {
                                className: "w-5 h-5 text-slate-600 transition-transform flex-shrink-0 " + (
                                  isExpanded ? "rotate-180" : ""
                                )
                              })
                        ],
                        className: "w-full flex items-center justify-between gap-3 mb-3 hover:opacity-80 transition-opacity",
                        onClick: (function (param) {
                            setIsExpanded(function (prev) {
                                  return !prev;
                                });
                          })
                      }),
                isExpanded ? JsxRuntime.jsxs(JsxRuntime.Fragment, {
                        children: [
                          JsxRuntime.jsx("div", {
                                children: matchesGrid,
                                style: isCurrentRound ? ({}) : ({
                                      pointerEvents: "none"
                                    })
                              }),
                          standbyPlayers.length > 0 ? JsxRuntime.jsxs("div", {
                                  children: [
                                    JsxRuntime.jsxs("button", {
                                          children: [
                                            JsxRuntime.jsxs("div", {
                                                  children: [
                                                    displayedPlayers.map(function (player, index) {
                                                          return JsxRuntime.jsx(PlayerAvatar.make, {
                                                                      userFragmentRefs: Core__Option.flatMap(player.data, getUserFragmentRefs),
                                                                      name: player.name,
                                                                      skillLevel: player.ratingOrdinal,
                                                                      size: "small",
                                                                      className: "w-6 h-6",
                                                                      style: {
                                                                        zIndex: (displayedPlayers.length - index | 0).toString()
                                                                      }
                                                                    }, player.id);
                                                        }),
                                                    remainingCount > 0 ? JsxRuntime.jsx("div", {
                                                            children: JsxRuntime.jsx("span", {
                                                                  children: "+" + remainingCount.toString(),
                                                                  className: "text-xs font-bold text-slate-600"
                                                                }),
                                                            className: "w-6 h-6 rounded-full bg-slate-300 border-2 border-white flex items-center justify-center",
                                                            style: {
                                                              zIndex: "0"
                                                            }
                                                          }) : null
                                                  ],
                                                  className: "flex items-center -space-x-2"
                                                }),
                                            JsxRuntime.jsx(LucideReact.ChevronDown, {
                                                  className: "w-3 h-3 text-slate-400 transition-transform " + (
                                                    showAllNotPlaying ? "rotate-180" : ""
                                                  )
                                                })
                                          ],
                                          className: "flex items-center gap-2 hover:opacity-80 transition-opacity",
                                          onClick: (function (param) {
                                              setShowAllNotPlaying(function (prev) {
                                                    return !prev;
                                                  });
                                            })
                                        }),
                                    showAllNotPlaying ? JsxRuntime.jsx("div", {
                                            children: standbyPlayers.map(function (player) {
                                                  return JsxRuntime.jsxs("div", {
                                                              children: [
                                                                JsxRuntime.jsx(PlayerAvatar.make, {
                                                                      userFragmentRefs: Core__Option.flatMap(player.data, getUserFragmentRefs),
                                                                      name: player.name,
                                                                      skillLevel: player.ratingOrdinal,
                                                                      size: "small",
                                                                      className: "w-7 h-7 flex-shrink-0"
                                                                    }),
                                                                JsxRuntime.jsx("div", {
                                                                      children: JsxRuntime.jsx("div", {
                                                                            children: player.name,
                                                                            className: "text-xs font-medium text-slate-800 truncate"
                                                                          }),
                                                                      className: "flex-1 min-w-0"
                                                                    })
                                                              ],
                                                              className: "flex items-center gap-2 p-2 rounded-lg bg-slate-50 border border-slate-200"
                                                            }, player.id);
                                                }),
                                            className: "mt-2 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2"
                                          }) : null
                                  ],
                                  className: "mt-3"
                                }) : null
                        ]
                      }) : null,
                Core__Option.getOr(Core__Option.map(replacementState, (function (param) {
                            return JsxRuntime.jsx(PlayerReplaceModal.make, {
                                        currentPlayer: param.player,
                                        availablePlayers: standbyPlayers,
                                        onSelect: handlePlayerSelect,
                                        onClose: handleCloseReplaceModal,
                                        getUserFragmentRefs: getUserFragmentRefs
                                      });
                          })), null)
              ],
              className: isCurrentRound ? "mb-6 rounded-xl transition-all bg-blue-50 border-4 border-blue-500 p-4 shadow-xl" : "mb-6 rounded-xl transition-all opacity-50 p-1"
            });
}

var make = RoundSection;

export {
  t$1 as t,
  HistoryCalculator ,
  AverageQualityDebug ,
  make ,
}
/*  Not a pure module */

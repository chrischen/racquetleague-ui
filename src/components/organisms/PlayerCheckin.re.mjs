// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Caml_option from "rescript/lib/es6/caml_option.js";
import * as Core__Array from "@rescript/core/src/Core__Array.re.mjs";
import * as Core__Option from "@rescript/core/src/Core__Option.re.mjs";
import * as PlayerAvatar from "./PlayerAvatar.re.mjs";
import * as LucideReact from "lucide-react";
import * as FramerMotion from "framer-motion";
import * as SeedAdjustModal from "./SeedAdjustModal.re.mjs";
import * as JsxRuntime from "react/jsx-runtime";
import * as RescriptRelay_Fragment from "rescript-relay/src/RescriptRelay_Fragment.re.mjs";
import * as PlayerCheckin_user_graphql from "../../__generated__/PlayerCheckin_user_graphql.re.mjs";

import { t } from '@lingui/macro'
;

import { css, cx } from '@linaria/core'
;

var convertFragment = PlayerCheckin_user_graphql.Internal.convertFragment;

function use(fRef) {
  return RescriptRelay_Fragment.useFragment(PlayerCheckin_user_graphql.node, convertFragment, fRef);
}

function useOpt(fRef) {
  return RescriptRelay_Fragment.useFragmentOpt(fRef !== undefined ? Caml_option.some(Caml_option.valFromOption(fRef)) : undefined, PlayerCheckin_user_graphql.node, convertFragment);
}

var Fragment = {
  Types: undefined,
  Operation: undefined,
  convertFragment: convertFragment,
  use: use,
  useOpt: useOpt
};

function PlayerCheckin(props) {
  var initialPlayers = props.initialPlayers;
  var getUserFragmentRefs = props.getUserFragmentRefs;
  var onOpenAddGuests = props.onOpenAddGuests;
  var onOpenPlayerSettings = props.onOpenPlayerSettings;
  var onOpenTeamManagement = props.onOpenTeamManagement;
  var onTogglePaid = props.onTogglePaid;
  var onToggleCheckin = props.onToggleCheckin;
  var checkedInPlayerIds = props.checkedInPlayerIds;
  var players = props.players;
  var checkedInCount = checkedInPlayerIds.size;
  var match = React.useState(function () {
        return false;
      });
  var setIsExpanded = match[1];
  var isExpanded = match[0];
  var match$1 = React.useState(function () {
        return false;
      });
  var setShowSeedModal = match$1[1];
  var totalPlayers = players.length;
  var ratingChanges = React.useMemo((function () {
          var initialMuMap = Core__Array.reduce(initialPlayers, new Map(), (function (acc, player) {
                  acc.set(player.id, player.rating.mu);
                  return acc;
                }));
          return Core__Array.reduce(players, new Map(), (function (acc, player) {
                        return Core__Option.getOr(Core__Option.map(initialMuMap.get(player.id), (function (initialMu) {
                                          var change = player.rating.mu - initialMu;
                                          if (change !== 0.0) {
                                            acc.set(player.id, change);
                                          }
                                          return acc;
                                        })), acc);
                      }));
        }), [
        players,
        initialPlayers
      ]);
  React.useEffect((function () {
          if (checkedInCount < 4) {
            setIsExpanded(function (param) {
                  return true;
                });
          }
          
        }), [checkedInCount]);
  var sortedPlayers = React.useMemo((function () {
          return players.toSorted(function (a, b) {
                      return b.rating.mu - a.rating.mu;
                    });
        }), [players]);
  var match$2 = React.useMemo((function () {
          if (players.length === 0) {
            return [
                    0,
                    0
                  ];
          }
          var muValues = players.map(function (p) {
                return p.rating.mu;
              });
          var min = Core__Array.reduce(muValues, 1e10, (function (acc, val) {
                  if (acc < val) {
                    return acc;
                  } else {
                    return val;
                  }
                }));
          var max = Core__Array.reduce(muValues, -1e10, (function (acc, val) {
                  if (acc > val) {
                    return acc;
                  } else {
                    return val;
                  }
                }));
          return [
                  min,
                  max
                ];
        }), [players]);
  var maxMu = match$2[1];
  var minMu = match$2[0];
  var normalizeSkillLevel = function (mu) {
    if (maxMu === minMu) {
      return 50;
    } else {
      return (mu - minMu) / (maxMu - minMu) * 100;
    }
  };
  return JsxRuntime.jsxs("div", {
              children: [
                JsxRuntime.jsx("div", {
                      children: JsxRuntime.jsxs("div", {
                            children: [
                              JsxRuntime.jsxs("button", {
                                    children: [
                                      JsxRuntime.jsx(LucideReact.UserCheck, {
                                            className: "w-5 h-5 text-blue-600 flex-shrink-0"
                                          }),
                                      JsxRuntime.jsx("h2", {
                                            children: t`Player Check-in`,
                                            className: "text-lg font-semibold text-slate-800"
                                          }),
                                      JsxRuntime.jsx("span", {
                                            children: t`${checkedInCount.toString()} of ${totalPlayers.toString()} checked in`,
                                            className: "text-sm text-slate-500"
                                          })
                                    ],
                                    className: "flex items-center gap-3 hover:opacity-80 transition-opacity",
                                    onClick: (function (param) {
                                        setIsExpanded(function (prev) {
                                              return !prev;
                                            });
                                      })
                                  }),
                              JsxRuntime.jsxs("div", {
                                    children: [
                                      JsxRuntime.jsx("button", {
                                            children: JsxRuntime.jsx(LucideReact.UserPlus, {
                                                  className: "w-4 h-4"
                                                }),
                                            className: "p-2 rounded-lg transition-colors flex items-center gap-1 bg-green-600 text-white hover:bg-green-700",
                                            title: t`Add guest players`,
                                            onClick: (function (param) {
                                                onOpenAddGuests();
                                              })
                                          }),
                                      JsxRuntime.jsx("button", {
                                            children: JsxRuntime.jsx(LucideReact.Users, {
                                                  className: "w-4 h-4"
                                                }),
                                            className: "p-2 rounded-lg transition-colors flex items-center gap-1 bg-slate-600 text-white hover:bg-slate-700",
                                            title: "Manage teams",
                                            onClick: (function (param) {
                                                onOpenTeamManagement();
                                              })
                                          }),
                                      JsxRuntime.jsxs("button", {
                                            children: [
                                              JsxRuntime.jsx(LucideReact.ArrowUpNarrowWide, {
                                                    className: "w-4 h-4"
                                                  }),
                                              JsxRuntime.jsx(LucideReact.User, {
                                                    className: "w-4 h-4"
                                                  })
                                            ],
                                            className: "p-2 rounded-lg transition-colors flex items-center gap-1 bg-blue-600 text-white hover:bg-blue-700",
                                            title: "Adjust player seeds",
                                            onClick: (function (param) {
                                                setShowSeedModal(function (param) {
                                                      return true;
                                                    });
                                              })
                                          }),
                                      JsxRuntime.jsx("button", {
                                            children: JsxRuntime.jsx(LucideReact.ChevronDown, {
                                                  className: isExpanded ? "w-5 h-5 text-slate-600 transition-transform rotate-180" : "w-5 h-5 text-slate-600 transition-transform"
                                                }),
                                            className: "p-2 hover:bg-slate-100 rounded-lg transition-colors",
                                            onClick: (function (param) {
                                                setIsExpanded(function (prev) {
                                                      return !prev;
                                                    });
                                              })
                                          })
                                    ],
                                    className: "flex items-center gap-2"
                                  })
                            ],
                            className: "flex flex-col sm:flex-row sm:items-center justify-between gap-3"
                          }),
                      className: "px-6 py-4"
                    }),
                isExpanded ? JsxRuntime.jsx("div", {
                        children: JsxRuntime.jsx("ul", {
                              children: JsxRuntime.jsx(FramerMotion.AnimatePresence, {
                                    children: sortedPlayers.map(function (player) {
                                          var isCheckedIn = checkedInPlayerIds.has(player.id);
                                          var playCount = player.count;
                                          var buttonClass = isCheckedIn ? "relative flex flex-col gap-2 p-2 rounded-lg border-2 transition-all border-green-500 bg-green-50" : "relative flex flex-col gap-2 p-2 rounded-lg border-2 transition-all border-slate-200 bg-slate-50";
                                          var nameClass = isCheckedIn ? "text-sm font-medium truncate w-full text-slate-800" : "text-sm font-medium truncate w-full text-slate-500";
                                          var skillLevel = normalizeSkillLevel(player.rating.mu);
                                          return JsxRuntime.jsx(FramerMotion.motion.li, {
                                                      style: {
                                                        originX: 0.05,
                                                        originY: 0.05
                                                      },
                                                      animate: {
                                                        opacity: 1,
                                                        scale: 1
                                                      },
                                                      initial: {
                                                        opacity: 0,
                                                        scale: 0.8
                                                      },
                                                      exit: {
                                                        opacity: 0,
                                                        scale: 0.8
                                                      },
                                                      layout: true,
                                                      children: Caml_option.some(JsxRuntime.jsxs("div", {
                                                                children: [
                                                                  JsxRuntime.jsx("button", {
                                                                        children: JsxRuntime.jsx(LucideReact.Settings, {
                                                                              className: "w-3 h-3 text-slate-500"
                                                                            }),
                                                                        className: "absolute top-1 right-1 p-1 hover:bg-slate-200 rounded transition-colors z-10",
                                                                        title: "Player settings",
                                                                        onClick: (function (e) {
                                                                            e.stopPropagation();
                                                                            onOpenPlayerSettings(player);
                                                                          })
                                                                      }),
                                                                  JsxRuntime.jsxs("button", {
                                                                        children: [
                                                                          JsxRuntime.jsx(PlayerAvatar.make, {
                                                                                userFragmentRefs: Core__Option.flatMap(player.data, getUserFragmentRefs),
                                                                                name: player.name,
                                                                                skillLevel: skillLevel,
                                                                                size: "medium"
                                                                              }),
                                                                          JsxRuntime.jsxs("div", {
                                                                                children: [
                                                                                  JsxRuntime.jsx("span", {
                                                                                        children: player.name,
                                                                                        className: nameClass
                                                                                      }),
                                                                                  JsxRuntime.jsx("span", {
                                                                                        children: "#" + player.intId.toString(),
                                                                                        className: "text-xs text-slate-400 font-mono"
                                                                                      })
                                                                                ],
                                                                                className: "flex flex-col items-start min-w-0 flex-1"
                                                                              }),
                                                                          isCheckedIn ? JsxRuntime.jsx(LucideReact.UserCheck, {
                                                                                  className: "w-4 h-4 text-green-600 flex-shrink-0"
                                                                                }) : JsxRuntime.jsx(LucideReact.UserX, {
                                                                                  className: "w-4 h-4 text-slate-400 flex-shrink-0"
                                                                                })
                                                                        ],
                                                                        className: "flex items-center gap-2 hover:opacity-80 transition-opacity w-full",
                                                                        onClick: (function (param) {
                                                                            onToggleCheckin(player.id);
                                                                          })
                                                                      }),
                                                                  JsxRuntime.jsxs("div", {
                                                                        children: [
                                                                          playCount > 0 ? JsxRuntime.jsxs("div", {
                                                                                  children: [
                                                                                    JsxRuntime.jsx(LucideReact.Play, {
                                                                                          className: "w-3 h-3"
                                                                                        }),
                                                                                    JsxRuntime.jsx("span", {
                                                                                          children: playCount.toString(),
                                                                                          className: "font-medium"
                                                                                        })
                                                                                  ],
                                                                                  className: "flex items-center gap-1 text-xs text-slate-600"
                                                                                }) : null,
                                                                          Core__Option.getOr(Core__Option.map(ratingChanges.get(player.id), (function (change) {
                                                                                      var isPositive = change > 0.0;
                                                                                      var changeText = change.toFixed(1);
                                                                                      return JsxRuntime.jsxs("div", {
                                                                                                  children: [
                                                                                                    isPositive ? JsxRuntime.jsx(LucideReact.TrendingUp, {
                                                                                                            className: "w-3 h-3"
                                                                                                          }) : JsxRuntime.jsx(LucideReact.TrendingDown, {
                                                                                                            className: "w-3 h-3"
                                                                                                          }),
                                                                                                    changeText
                                                                                                  ],
                                                                                                  className: isPositive ? "flex items-center gap-0.5 text-xs font-bold text-green-600" : "flex items-center gap-0.5 text-xs font-bold text-red-600"
                                                                                                });
                                                                                    })), null),
                                                                          JsxRuntime.jsx("button", {
                                                                                children: t`$`,
                                                                                className: player.paid ? "px-1.5 py-0.5 rounded transition-all flex-shrink-0 ml-auto bg-green-600 hover:bg-green-700 text-white text-xs font-bold" : "px-1.5 py-0.5 rounded transition-all flex-shrink-0 ml-auto bg-slate-300 hover:bg-slate-400 text-slate-600 text-xs font-bold",
                                                                                title: player.paid ? t`Paid` : t`Not paid`,
                                                                                onClick: (function (e) {
                                                                                    e.stopPropagation();
                                                                                    onTogglePaid(player.id);
                                                                                  })
                                                                              })
                                                                        ],
                                                                        className: "flex items-center justify-between gap-2 px-1"
                                                                      })
                                                                ],
                                                                className: buttonClass
                                                              }))
                                                    }, player.id);
                                        })
                                  }),
                              className: "grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 list-none"
                            }),
                        className: "px-6 pb-4"
                      }) : null,
                match$1[0] ? JsxRuntime.jsx(SeedAdjustModal.make, {
                        players: players,
                        onSave: props.onAdjustSeeds,
                        onClose: (function () {
                            setShowSeedModal(function (param) {
                                  return false;
                                });
                          }),
                        getUserFragmentRefs: getUserFragmentRefs
                      }) : null
              ],
              className: "bg-white border-b border-slate-200"
            });
}

var make = PlayerCheckin;

export {
  Fragment ,
  make ,
}
/*  Not a pure module */
